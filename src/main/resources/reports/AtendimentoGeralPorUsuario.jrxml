<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.4.3.final using JasperReports Library version 6.4.3  -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="AtendimentosPorUsuario" pageWidth="842" pageHeight="595" orientation="Landscape" whenNoDataType="NoDataSection" columnWidth="802" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="f21cfcea-ed11-4f6a-a2cd-c5a61270b48c">
	<property name="ireport.zoom" value="1.3310000000000006"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="Sics PostGres Dev"/>
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<parameter name="dt_inicio" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="dt_fim" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="nomeHospital" class="java.lang.String"/>
	<parameter name="logo_cliente" class="java.io.InputStream"/>
	<parameter name="nomeOuLogin" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[select distinct a.id_usuario, u.nome as nome_usuario, u.login,
a.id_guiche, g.nome as nome_guiche,
a.id_fila, f.nome as nome_fila,
a.id_atendimento, a.tipo_senha,
case 
	when a.tipo_senha = 'P' then 'Prioridade'
	when a.tipo_senha = 'S' then 'Prioridade Especial'
	when a.tipo_senha = 'N' then 'Normal'
end as tipo_prioridade
from atendimento a
inner join usuario u on u.id_usuario = a.id_usuario and u.exclusao = false
inner join guiche g on g.id_guiche = a.id_guiche and g.exclusao = false
inner join fila f on f.id_fila = a.id_fila and f.exclusao = false
inner join usuario_perfil up on up.id_usuario = a.id_usuario
where a.id_guiche is not null
and a.status_senha = 'I'
and ((a.dt_atendimento is null and a.dt_senha between $P{dt_inicio} and $P{dt_fim}) or
(a.dt_atendimento is not null and a.dt_atendimento between $P{dt_inicio} and $P{dt_fim}))
and (translate(trim(upper(u.nome)), 'ÁÉÍÓÚÀÈÌÒÙÂÊÎÔÛÃÕÄËÏÖÜÇÑYÝ','AEIOUAEIOUAEIOUAOAEIOUCNYY') like
			translate(trim(upper($P{nomeOuLogin})), 'ÁÉÍÓÚÀÈÌÒÙÂÊÎÔÛÃÕÄËÏÖÜÇÑYÝ','AEIOUAEIOUAEIOUAOAEIOUCNYY')
	   or translate(trim(upper(u.login)), 'ÁÉÍÓÚÀÈÌÒÙÂÊÎÔÛÃÕÄËÏÖÜÇÑYÝ','AEIOUAEIOUAEIOUAOAEIOUCNYY') like
			translate(trim(upper($P{nomeOuLogin})), 'ÁÉÍÓÚÀÈÌÒÙÂÊÎÔÛÃÕÄËÏÖÜÇÑYÝ','AEIOUAEIOUAEIOUAOAEIOUCNYY'))
order by u.nome, f.nome, a.tipo_senha]]>
	</queryString>
	<field name="id_usuario" class="java.lang.Integer">
		<property name="com.jaspersoft.studio.field.label" value="id_usuario"/>
	</field>
	<field name="nome_usuario" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.label" value="nome_usuario"/>
	</field>
	<field name="login" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.label" value="login"/>
	</field>
	<field name="id_guiche" class="java.lang.Integer">
		<property name="com.jaspersoft.studio.field.label" value="id_guiche"/>
	</field>
	<field name="nome_guiche" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.label" value="nome_guiche"/>
	</field>
	<field name="id_fila" class="java.lang.Integer">
		<property name="com.jaspersoft.studio.field.label" value="id_fila"/>
	</field>
	<field name="nome_fila" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.label" value="nome_fila"/>
	</field>
	<field name="id_atendimento" class="java.lang.Long">
		<property name="com.jaspersoft.studio.field.label" value="id_atendimento"/>
	</field>
	<field name="tipo_senha" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.label" value="tipo_senha"/>
	</field>
	<field name="tipo_prioridade" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.label" value="tipo_prioridade"/>
	</field>
	<variable name="id_atendimento_1" class="java.lang.Long" resetType="Group" resetGroup="grp_guiche" calculation="Sum">
		<variableExpression><![CDATA[1]]></variableExpression>
	</variable>
	<variable name="total_usuario" class="java.lang.Integer" resetType="Group" resetGroup="grp_usuario" calculation="Sum">
		<variableExpression><![CDATA[1]]></variableExpression>
	</variable>
	<variable name="total_geral" class="java.lang.Long" calculation="Count">
		<variableExpression><![CDATA[1]]></variableExpression>
	</variable>
	<group name="grp_usuario" isReprintHeaderOnEachPage="true">
		<groupExpression><![CDATA[$F{id_usuario}]]></groupExpression>
		<groupHeader>
			<band height="20">
				<textField>
					<reportElement x="0" y="0" width="190" height="17" uuid="b69a8358-c097-4668-8cb6-2055637c3d35"/>
					<textElement>
						<font fontName="Arial"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{nome_usuario}.trim() + " (" + $F{id_usuario}.toString() + ")"]]></textFieldExpression>
				</textField>
				<textField>
					<reportElement x="190" y="0" width="110" height="17" uuid="72a50eb1-7503-45e5-a8b6-e91e6c19210d"/>
					<textElement>
						<font fontName="Arial"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{login}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="20">
				<line>
					<reportElement x="0" y="0" width="802" height="1" uuid="a6f72da4-f9e6-42fc-83c2-b66ff036096b"/>
					<graphicElement>
						<pen lineStyle="Dotted"/>
					</graphicElement>
				</line>
				<textField pattern="###,##0">
					<reportElement x="700" y="1" width="100" height="17" uuid="c6c76923-6724-449c-a719-0ba39f24108e"/>
					<textElement textAlignment="Right">
						<font fontName="Arial"/>
					</textElement>
					<textFieldExpression><![CDATA[$V{total_usuario}]]></textFieldExpression>
				</textField>
			</band>
		</groupFooter>
	</group>
	<group name="grp_guiche" isReprintHeaderOnEachPage="true">
		<groupExpression><![CDATA[$F{id_fila}.toString() + $F{tipo_senha}]]></groupExpression>
		<groupHeader>
			<band height="20">
				<textField>
					<reportElement x="300" y="0" width="400" height="17" uuid="7e859cf1-8403-46a0-8fdd-efd00d36b1f2">
						<property name="com.jaspersoft.studio.unit.x" value="px"/>
						<property name="com.jaspersoft.studio.unit.width" value="px"/>
					</reportElement>
					<box>
						<topPen lineWidth="1.0" lineStyle="Dotted"/>
					</box>
					<textElement>
						<font fontName="Arial"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{nome_fila}.trim() + " (" + $F{tipo_prioridade} + ")"]]></textFieldExpression>
				</textField>
				<textField evaluationTime="Group" evaluationGroup="grp_guiche" pattern="###,##0">
					<reportElement x="700" y="0" width="100" height="17" uuid="26248116-ee79-47eb-9ddc-cd7bb9e89cce"/>
					<box>
						<topPen lineWidth="1.0" lineStyle="Dotted"/>
					</box>
					<textElement textAlignment="Right">
						<font fontName="Arial"/>
					</textElement>
					<textFieldExpression><![CDATA[$V{id_atendimento_1}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="10"/>
		</groupFooter>
	</group>
	<background>
		<band splitType="Stretch"/>
	</background>
	<pageHeader>
		<band height="160" splitType="Stretch">
			<textField>
				<reportElement x="0" y="75" width="802" height="25" uuid="1c66a929-0d7c-40c0-a076-f31c4bc4409b"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="16" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{nomeHospital}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement mode="Opaque" x="0" y="100" width="802" height="25" backcolor="#00CC99" uuid="60852010-0fbb-490c-bfd8-6c348d72f753"/>
				<box>
					<topPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial Black" size="16"/>
				</textElement>
				<text><![CDATA[RELATÓRIO DE ATENDIMENTOS X USUÁRIO]]></text>
			</staticText>
			<staticText>
				<reportElement x="552" y="30" width="100" height="20" uuid="1bbd7f69-2ae7-44af-86a4-b0014bfbc408"/>
				<textElement textAlignment="Right">
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[Emissão ]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy HH:mm">
				<reportElement x="652" y="30" width="150" height="20" uuid="ce307234-1709-4f07-9db0-ab5bc296bae4"/>
				<textElement textAlignment="Right">
					<font fontName="Arial" size="12"/>
				</textElement>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="552" y="50" width="100" height="20" uuid="726ae3ff-b737-4714-8950-958a72dc348a"/>
				<textElement textAlignment="Right">
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[Período de ]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy HH.mm.ss">
				<reportElement x="652" y="50" width="150" height="20" uuid="94b324f4-2f94-4ba4-ae19-55ac80049653"/>
				<textElement textAlignment="Right">
					<font fontName="Arial" size="12"/>
				</textElement>
				<textFieldExpression><![CDATA[new SimpleDateFormat("dd/MM/yyyy").format($P{dt_inicio}) + " a " +
new SimpleDateFormat("dd/MM/yyyy").format($P{dt_fim})]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="0" y="130" width="190" height="20" uuid="eaf3365b-a51e-4732-adae-b22149681568"/>
				<box>
					<topPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<text><![CDATA[USUÁRIO]]></text>
			</staticText>
			<staticText>
				<reportElement x="700" y="130" width="100" height="20" uuid="be6b68db-df20-48f7-ac05-a3d54ed6a2a5"/>
				<box>
					<topPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<text><![CDATA[QTDE]]></text>
			</staticText>
			<staticText>
				<reportElement x="300" y="130" width="400" height="20" uuid="9494050d-d18a-4b4c-9501-86e742744c42">
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<box>
					<topPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<text><![CDATA[SERVIÇO]]></text>
			</staticText>
			<staticText>
				<reportElement x="190" y="130" width="110" height="20" uuid="63b0445f-ef97-4439-b267-b9df24b8599d"/>
				<box>
					<topPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<text><![CDATA[LOGIN]]></text>
			</staticText>
			<image scaleImage="RetainShape" isUsingCache="true" isLazy="true">
				<reportElement x="0" y="0" width="160" height="75" uuid="f327d6e8-2130-4340-8952-b18811b8d2da"/>
				<imageExpression><![CDATA[$P{logo_cliente}]]></imageExpression>
			</image>
		</band>
	</pageHeader>
	<pageFooter>
		<band height="30" splitType="Stretch">
			<line>
				<reportElement x="0" y="0" width="802" height="1" uuid="02ebb01a-79e8-4ba6-befc-20afbdf6e7f1"/>
			</line>
			<textField>
				<reportElement x="680" y="0" width="80" height="20" uuid="ba5f00ab-899d-4c94-b0c6-12e2d1596eae"/>
				<textElement textAlignment="Right"/>
				<textFieldExpression><![CDATA["Página "+$V{PAGE_NUMBER}+" de"]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report">
				<reportElement x="760" y="0" width="40" height="20" uuid="97cb0de0-b2b9-4dfb-812b-dd026ff26290"/>
				<textFieldExpression><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
	<summary>
		<band height="20">
			<textField pattern="###,##0">
				<reportElement x="700" y="0" width="100" height="20" uuid="2fe85c82-2b41-4b87-bafb-0febbb5aeb27"/>
				<textElement textAlignment="Right">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{total_geral}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="600" y="0" width="100" height="20" uuid="b7663c28-e2c4-4875-a540-b5c4d33f5a05"/>
				<textElement textAlignment="Right">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total :]]></text>
			</staticText>
		</band>
	</summary>
	<noData>
		<band height="50">
			<staticText>
				<reportElement x="0" y="0" width="802" height="50" uuid="b997fc35-b36a-44f5-bdd8-bde8c2073f22"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial Black" size="20"/>
				</textElement>
				<text><![CDATA[Não existem informações a serem impressas]]></text>
			</staticText>
		</band>
	</noData>
</jasperReport>
